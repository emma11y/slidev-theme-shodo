import{d as ne,e as oe,_ as le,f as ie,g as ae}from"../modules/unplugin-icons-yvtIbPUE.js";import{d as G,aa as se,R as ce,t as B,ab as re,D as F,E as de,a4 as ue,n as J,H as c,o as i,c as w,i as S,h as U,ac as me,ad as pe,b,j as fe,N as ve,y as O,U as he,ae as ge,e as s,F as K,af as L,k as N,g as T,x as y,l as _}from"../modules/vue-BHIC3QRz.js";import{u as ke,a as _e,c as be,C as P,g as j}from"../index-ByDRFW8y.js";import{i as xe,f as q,g as ye,b as we,p as Ce}from"../monaco/bundled-types-BSQQkv1f.js";import{u as $e,S as Se,_ as De,a as Ee}from"./DrawingPreview.vue_vue_type_script_setup_true_lang-CnYjhsSM.js";import{_ as R}from"./IconButton.vue_vue_type_script_setup_true_lang-CgFbssxI.js";import{_ as He,C as Me}from"./ClicksSlider-quqznZmA.js";import"../modules/shiki-CfCxQgMn.js";import"../modules/file-saver-igGfcqei.js";import"../_plugin-vue_export-helper-DlAUqK2U.js";const Ne=["placeholder"],Te=G({__name:"NoteEditable",props:{no:{type:Number,required:!0},class:{default:""},editing:{default:!1},style:{default:()=>({})},placeholder:{default:"No notes for this slide"},clicksContext:{type:Object},highlight:{default:!0},autoHeight:{default:!1}},emits:["update:editing","markerDblclick","markerClick"],setup(C,{emit:z}){const o=C,x=z,r=se(o,"editing",x,{passive:!0}),{info:f,update:D}=$e(ce(o,"no")),v=B("");let E;const{ignoreUpdates:g}=re(v,u=>{if(!r.value)return;const m=o.no;clearTimeout(E),E=setTimeout(()=>{D({note:u},m)},500)});F(()=>{var u;return(u=f.value)==null?void 0:u.note},(u="")=>{r.value||(clearTimeout(E),g(()=>{v.value=u}))},{immediate:!0,flush:"sync"});const d=B(),k=B();de(()=>{var u;r.value&&((u=d.value)==null||u.focus())}),ue(d,()=>{r.value=!1});function I(){!o.autoHeight||!d.value||!r.value||d.value.scrollHeight>d.value.clientHeight&&(d.value.style.height=`${d.value.scrollHeight}px`)}return F([v,r],()=>{J(()=>{I()})},{flush:"post",immediate:!0}),(u,m)=>{var V;return c(r)?me((i(),b("textarea",{key:1,ref_key:"inputEl",ref:d,"onUpdate:modelValue":m[2]||(m[2]=h=>v.value=h),class:S(["prose resize-none overflow-auto outline-none bg-transparent block border-primary border-2",o.class]),style:U([{"line-height":"1.75"},[o.style,k.value!=null?{height:`${k.value}px`}:{}]]),placeholder:C.placeholder,onKeydown:m[3]||(m[3]=fe(h=>r.value=!1,["esc"]))},null,46,Ne)),[[pe,v.value]]):(i(),w(He,{key:0,class:S(["border-transparent border-2",[o.class,v.value?"":"opacity-25 italic select-none"]]),style:U(o.style),note:v.value||C.placeholder,"note-html":(V=c(f))==null?void 0:V.noteHTML,"clicks-context":C.clicksContext,"auto-scroll":!C.autoHeight,highlight:o.highlight,onMarkerClick:m[0]||(m[0]=(h,$)=>x("markerClick",h,$)),onMarkerDblclick:m[1]||(m[1]=(h,$)=>x("markerDblclick",h,$))},null,8,["class","style","note","note-html","clicks-context","auto-scroll","highlight"]))}}}),Be={class:"h-screen w-screen of-hidden flex"},Ie={class:"grid grid-rows-[auto_max-content] border-r border-main select-none max-h-full h-full"},Ve={class:"relative"},We={class:"absolute left-0 top-0 bottom-0 w-200 flex flex-col flex-auto items-end group p2 gap-1 max-h-full of-x-visible of-y-auto",style:{direction:"rtl"}},Re=["onClick"],ze={p2:"",border:"t main"},Oe={class:"select-none w-13 text-right my4 flex flex-col gap-1 items-end"},Ue={class:"text-3xl op20 mb2"},Ae={class:"flex flex-col gap-2 my5"},Fe=["onDblclick"],Ke={class:"py3 mt-0.5 mr--8 ml--4 op0 transition group-hover:op100"},Le={key:0,class:"select-none absolute bottom-0 right-0 bg-main rounded-tl p2 op35 text-xs"},Pe={class:"absolute top-0 right-0 px3 py1.5 border-b border-l rounded-lb bg-main border-main select-none"},je={class:"text-xs op50"},X=450,lt=G({__name:"overview",setup(C){ke({title:`Overview - ${we}`});const{openInEditor:z,slides:o}=_e(),x=ve(new Map),r=B([]),f=B(null),D=O(()=>o.value.map(t=>{var e,l;return m(((l=(e=t.meta)==null?void 0:e.slide)==null?void 0:l.note)||"")})),v=O(()=>D.value.reduce((t,e)=>t+e,0)),E=O(()=>o.value.map(t=>I(t)).reduce((t,e)=>t+e,0)),g=he(),d=new WeakMap;function k(t){return d.has(t)||d.set(t,be(t,P)),d.get(t)}function I(t){var e,l;return((e=t.meta)==null?void 0:e.clicks)||((l=k(t))==null?void 0:l.total)}function u(t){g.value===t?g.value=void 0:g.value=t}function m(t){var e;return((e=t.match(/[\w`'\-]+/g))==null?void 0:e.length)||0}function V(t){const e=t.getBoundingClientRect(),l=20;return e.top>=0-l&&e.left>=0-l&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)+l&&e.right<=(window.innerWidth||document.documentElement.clientWidth)+l}function h(){const t=[];Array.from(x.entries()).forEach(([e,l])=>{V(l)&&t.push(e)}),r.value=t}function $(t){const e=document.createElement("a");e.target="_blank",e.href=Ce+t.slice(1),e.click()}function Q(t){const e=x.get(t);e&&e.scrollIntoView({behavior:"smooth",block:"start"})}function Y(t,e,l){const H=k(l);H.current===e?H.current=P:H.current=e,t.preventDefault()}return ge(()=>{J(()=>{h()})}),(t,e)=>{const l=ne,H=oe,Z=le,ee=ie,te=ae;return i(),b("div",Be,[s("nav",Ie,[s("div",Ve,[s("div",We,[(i(!0),b(K,null,L(c(o),(n,p)=>{var M,a,W,A;return i(),b("div",{key:n.no,class:"relative",style:{direction:"ltr"}},[s("button",{class:S(["relative transition duration-300 w-8 h-8 rounded hover:bg-active hover:op100",r.value.includes(p)?"op100 text-primary bg-gray:5":"op20"]),onClick:qe=>Q(p)},[s("div",null,y(p+1),1)],10,Re),(a=(M=n.meta)==null?void 0:M.slide)!=null&&a.title?(i(),b("div",{key:0,class:S(["pointer-events-none select-none absolute left-110% backdrop-blur-8 top-50% translate-y--50% ws-nowrap z-10 px2 shadow-xl rounded border border-main transition duration-400 op0 group-hover:op100",r.value.includes(p)?"text-primary":"text-main important-text-op-50"])},y((A=(W=n.meta)==null?void 0:W.slide)==null?void 0:A.title),3)):T("v-if",!0)])}),128))])]),s("div",ze,[c(xe)?T("v-if",!0):(i(),w(R,{key:0,title:c(q)?"Switch to light mode theme":"Switch to dark mode theme",onClick:e[0]||(e[0]=n=>c(ye)())},{default:N(()=>[c(q)?(i(),w(l,{key:0})):(i(),w(H,{key:1}))]),_:1},8,["title"]))])]),s("main",{class:"flex-1 h-full of-auto",style:U(`grid-template-columns: repeat(auto-fit,minmax(${X}px,1fr))`),onScroll:h},[(i(!0),b(K,null,L(c(o),(n,p)=>{var M;return i(),b("div",{key:n.no,ref_for:!0,ref:a=>x.set(p,a),class:S(["relative border-t border-main of-hidden flex gap-4 min-h-50 group",p===0?"pt5":""])},[s("div",Oe,[s("div",Ue,y(p+1),1),_(R,{class:"mr--3 op0 group-hover:op80",title:"Play in new tab",onClick:a=>$(c(j)(n,!1))},{default:N(()=>[_(Z)]),_:2},1032,["onClick"]),(M=n.meta)!=null&&M.slide?(i(),w(R,{key:0,class:"mr--3 op0 group-hover:op80",title:"Open in editor",onClick:a=>c(z)(`${n.meta.slide.filepath}:${n.meta.slide.start}`)},{default:N(()=>[_(ee)]),_:2},1032,["onClick"])):T("v-if",!0)]),s("div",Ae,[s("div",{class:"border rounded border-main overflow-hidden bg-main select-none h-max",onDblclick:a=>$(c(j)(n,!1))},[(i(),w(Ee,{key:n.no,width:X,class:"pointer-events-none important:[&_*]:select-none"},{default:N(()=>[_(Se,{"clicks-context":k(n),route:n,"render-context":"overview"},null,8,["clicks-context","route"]),_(De,{page:n.no},null,8,["page"])]),_:2},1024))],40,Fe),I(n)?(i(),w(Me,{key:0,active:g.value===n,"clicks-context":k(n),class:"w-full mt-2",onDblclick:a=>u(n),onClick:a=>g.value=n},null,8,["active","clicks-context","onDblclick","onClick"])):T("v-if",!0)]),s("div",Ke,[_(R,{title:"Edit Note",class:S(["rounded-full w-9 h-9 text-sm",f.value===n.no?"important:op0":""]),onClick:a=>f.value=n.no},{default:N(()=>[_(te)]),_:2},1032,["class","onClick"])]),_(Te,{no:n.no,class:"max-w-250 w-250 text-lg rounded p3","auto-height":!0,highlight:g.value===n,editing:f.value===n.no,"clicks-context":k(n),onDblclick:a=>f.value!==n.no?f.value=n.no:null,"onUpdate:editing":e[1]||(e[1]=a=>f.value=null),onMarkerClick:(a,W)=>Y(a,W,n)},null,8,["no","highlight","editing","clicks-context","onDblclick","onMarkerClick"]),D.value[p]>0?(i(),b("div",Le,y(D.value[p])+" words ",1)):T("v-if",!0)],2)}),128))],36),s("div",Pe,[s("div",je,y(c(o).length)+" slides · "+y(E.value+c(o).length-1)+" clicks · "+y(v.value)+" words ",1)])])}}});export{lt as default};
